<html>

<head>
    <title>Bluetag - Login</title>
    <link rel="stylesheet" href="{{url_for('static', filename='bootstrap/bootstrap.min.css')}}" />
    <link rel="stylesheet" href="{{url_for('static', filename='fontawsome/all.min.css')}}" />
    <style>
        .gradient-custom {
            background: #6a11cb;
            background: -webkit-linear-gradient(to right, rgb(72, 151, 215), rgba(25, 95, 215, 1));
            background: linear-gradient(to right, rgb(78, 151, 211), rgba(25, 95, 215, 1))
        }
        .btn_text {
        font-weight: bold;
        font-size: medium;
        color:white;
        }
    </style>
</head>

<body>
        <section class="vh-100 gradient-custom">
            <div class="container py-5 h-100">
              <div class="row d-flex justify-content-center align-items-center h-100">
                <div class="col-12 col-md-8 col-lg-6 col-xl-5">
                  <div class="card bg-dark text-white" style="border-radius: 1rem;">
                    <div class="card-body p-5 text-center">
          
                      <div class="mb-md-5 mt-md-4 pb-5">
          
                        <h2 class="fw-bold mb-2 text-uppercase h1">Login</h2>
                        <p class="text-white-50 mb-5 h5">-- Eink Display System --</p>
          
                        <div class="form-outline form-white mb-4">
                            <label class="form-label" style="font-size: medium;">Login name</label>
                            <input type="email" id="js-login-name" class="form-control form-control-lg" />
                        </div>
          
                        <div class="form-outline form-white mb-4">
                            <label class="form-label" style="font-size: medium;">Password</label>
                            <input type="password" id="js-login-pwd" class="form-control form-control-lg" />
                        </div>
          
                        <button onclick="javascript:login()" class="btn btn-outline-light btn-lg px-5" type="submit">Login</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
        </section><div class="container">

    <script src="{{url_for('static', filename='jquerry/jquery-3.5.1.min.js')}}"></script>
    <script src="{{url_for('static', filename='bootstrap/bootstrap.min.js')}}"></script>
    <script src="{{url_for('static', filename='fontawsome/all.min.js')}}"></script>
    <script src="{{url_for('static', filename='scripts/core.js')}}"></script>
    <script src="{{url_for('static', filename='scripts/api-client.js')}}"></script>
    <script>
        function login() {
            let loginName = $('#js-login-name').val();
            let loginPwd = $('#js-login-pwd').val();

            // sha256(loginPwd).then(pwdHash => { });

            loginCall(loginName, loginPwd, {
                complete: () => { },
                success: (response) => { 
                    if (response.code === '0') {
                        const token = response.data.token 
                        sessionStorage.setItem('token', token);
                        sessionStorage.setItem('tokenExpired', response.data.expired);
                        localStorage.setItem('loginName', loginName);
                        localStorage.setItem('pwdHash', loginPwd);

                        window.location = '/dashboard';
                    } else {
                        alert(response.msg);
                    }
                },
                error: () => {
                    alert('Login failed, try again later...');
                }
            });
        }

        $(() => {
            document.addEventListener('keypress', (e) => {
                if (e.code === "Enter") {
                    login();
                }
            });

            if (localStorage.getItem('loginName') !== null) {
                loginCall(localStorage.getItem('loginName'), localStorage.getItem('pwdHash'), {
                    complete: () => { },
                    success: (response) => {
                        if (response.code === '0') {
                            sessionStorage.setItem('token', response.data.token);
                            sessionStorage.setItem('tokenExpired', response.data.expired);

                            window.location = '/dashboard';
                        } else {
                            alert(response.msg);
                        }
                    },
                    error: () => {
                        alert('Login failed, try again later...');
                    }
                });
            }
        });
    </script>

</html>